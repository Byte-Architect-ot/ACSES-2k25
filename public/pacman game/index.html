<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-142539004-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-142539004-1');
  </script>

  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <title>Pacman</title>
  <meta name="author" content="Brent Ward">
  <meta name="description" content="The classic arcade game Pac-Man! Remade in Javascript by Brent Ward">
  <meta name="keywords" content="Pac-Man, games, retro, arcade">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  </script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA6idvxl4_OIO1VeFFHbBOUoDpBSQLt6Zk",
    authDomain: "iwily-6ba06.firebaseapp.com",
    projectId: "iwily-6ba06",
    storageBucket: "iwily-6ba06.firebasestorage.app",
    messagingSenderId: "999137327774",
    appId: "1:999137327774:web:ccab4d1eab9ed1813f198f",
    measurementId: "G-E6TZBK87BZ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // expose globally so your other code can call it
  window.sendScore2fb = async function () {
    const username = localStorage.getItem("username");
    const score = localStorage.getItem("highScore");

    try {
      await addDoc(collection(db, "leaderboard"), {
        username,
        score: Number(score),
        timestamp: new Date()
      });
      console.log("Score uploaded! to fb");
    } catch (e) {
      console.error("Error adding doc:    gand mra bhai ", e);
    }
  };
</script>



  <style>
    @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=Inter:wght@300;400;500;600;700;800;900&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #000;
      /* color: #fff; */
      overflow-x: hidden;
      cursor: default;
    }

    .bg-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        linear-gradient(45deg, rgba(26, 0, 0, 0.6) 0%, rgba(51, 0, 0, 0.6) 25%, rgba(77, 0, 0, 0.6) 50%, rgba(51, 0, 0, 0.6) 75%, rgba(26, 0, 0, 0.6) 100%),
        url('../bg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: 0;
      animation: flicker 4s infinite alternate;
    }

    @keyframes flicker {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.9;
      }
    }

    /* Red Floating Particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: #ff3333;
      border-radius: 50%;
      opacity: 1;
    }

    /* Hero Section */

    /* Responsive */
    @media (max-width: 768px) {
      .hero-title {
        font-size: 4rem;
      }

      .hero-subtitle {
        font-size: 1.5rem;
      }

      .section-title {
        font-size: 2.5rem;
      }

      .cards-container {
        grid-template-columns: 1fr;
        padding: 0 1rem;
      }
    }
  </style>
</head>

<body>
  <!-- <div class="cursor"></div> -->
  <div class="bg-overlay"></div>
  <div class="particles" id="particles"></div>

  <!-- Hero Section -->
  <section class="hero">

  </section>
  <div id="overflow-mask" class="overflow-mask">
    <!-- <img id="backdrop" class="backdrop" src="app/style/graphics/backdrop.png" alt="Backdrop"> -->

    <div id="fps-display" class="fps-display"></div>
    <div id="preload-div" class="preload-div"></div>

    <div id="main-menu-container" class="main-menu-container">

      <img id="logo" class="logo" src="app/style/graphics/pacman_logo.png" alt="Pacman Logo">
      <button id="game-start" class="game-start" onclick="startGameUI()">
        PLAY
      </button>
    </div>

    <div class="header-buttons">
      <a href=""></a>
      <span>
        <button>
          <i id="pause-button" class="material-icons">pause</i>
        </button>
        <button>
          <i id="sound-button" class="material-icons">volume_up</i>
        </button>
      </span>
    </div>

    <div id="paused-text" class="paused-text">PAUSED</div>

    <div id="game-ui" class="game-ui">
      <div id="row-top" class="row top">
        <div class="column _25">
          <div id="points-display"></div>
        </div>
        <div class="column _50">
          <div>HIGH SCORE</div>
          <div id="high-score-display"></div>
        </div>
      </div>
      <div id="maze" class="maze">
        <img id="maze-img" class="maze-img" src="app/style/graphics/spriteSheets/maze/maze_blue.svg" alt="Maze">
        <div id="maze-cover" class="maze-cover"></div>
        <div id="dot-container"></div>
        <p id="pacman" class="pacman"></p>
        <p id="pacman-arrow" class="pacman"></p>
        <p id="clyde" class="ghost"></p>
        <p id="inky" class="ghost"></p>
        <p id="pinky" class="ghost"></p>
        <p id="blinky" class="ghost"></p>
      </div>

      <div id="bottom-row" class="row bottom mt-1 ml-4">
        <p class="mt-1">Available Lives : </p>
        <div id="extra-lives" class="extra-lives"></div>
        <div id="fruit-display" class="fruit-display"></div>
      </div>
    </div>

    <div id="left-cover" class="loading-cover left"></div>
    <div id="right-cover" class="loading-cover right"></div>
    <div id="loading-container" class="loading-container">
      <div id="loading-pacman" class="loading-pacman"></div>
      <div id="loading-dot-mask" class="loading-dot-mask"></div>
      <div class="loading-dot _5"></div>
      <div class="loading-dot _10"></div>
      <div class="loading-dot _15"></div>
      <div class="loading-dot _20"></div>
      <div class="loading-dot _25"></div>
      <div class="loading-dot _30"></div>
      <div class="loading-dot _35"></div>
      <div class="loading-dot _40"></div>
      <div class="loading-dot _45"></div>
      <div class="loading-dot _50"></div>
      <div class="loading-dot _55"></div>
      <div class="loading-dot _60"></div>
      <div class="loading-dot _65"></div>
      <div class="loading-dot _70"></div>
      <div class="loading-dot _75"></div>
      <div class="loading-dot _80"></div>
      <div class="loading-dot _85"></div>
      <div class="loading-dot _90"></div>
      <div class="loading-dot _95"></div>
    </div>

    <div id="error-message" class="error-message">
      <div class="header">
        <div>OOPS!</div>
        <div class="error-pacman"></div>
      </div>
      <div class="body">
        We were unable to load the images/sounds needed to play the game.<br><br>
        This could be due to a poor connection, a strict network policy, or
        by playing on an unsupported browser.
      </div>
    </div>
    <div class="keyboard-container" id="keyboard-container">
      <div id="keyboard"></div>
    </div>
  </div>

  <!-- Toggle button for mobile -->
  <!--<button class="keyboard-toggle" id="keyboard-toggle" onclick="toggleKeyboard()">Open controller</button> -->

  <script>
    window.onload = () => {
      if (typeof GameCoordinator === 'function') {
        let gameCoordinator = new GameCoordinator();
      } else {
        console.error('GameCoordinator not found. Ensure build/app.js is loaded before calling new GameCoordinator().');
      }

      // Show header controls only after game starts
      const playBtn = document.getElementById('game-start');
      if (playBtn) {
        playBtn.addEventListener('click', () => {
          document.body.classList.add('game-started');
        });
      }
    }
  </script>
  </div>
  <script src="build/app.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
  <!-- Load app after DOM to avoid race conditions -->
  <script src="build/app.js"></script>
  <script>
    // Register GSAP plugins
    gsap.registerPlugin(ScrollTrigger, TextPlugin);

    const links = document.querySelectorAll('button, .game-card');

    // Create red floating particles
    function createParticles() {
      const particlesContainer = document.getElementById('particles');

      for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');

        gsap.set(particle, {
          x: Math.random() * window.innerWidth,
          y: Math.random() * window.innerHeight,
          scale: Math.random() * 0.5 + 0.5
        });

        particlesContainer.appendChild(particle);

        gsap.to(particle, {
          y: "-=50",
          x: `+=${Math.random() * 100 - 50}`,
          duration: Math.random() * 3 + 2,
          repeat: -1,
          yoyo: true,
          ease: "sine.inOut"
        });

        gsap.to(particle, {
          opacity: Math.random() * 0.5 + 0.3,
          duration: Math.random() * 2 + 1,
          repeat: -1,
          yoyo: true
        });
      }
    }

    // Hero Animations
    gsap.timeline()
      .from('.hero-title', {
        duration: 1.5,
        y: 100,
        opacity: 0,
        ease: "power3.out"
      })
      .from('.hero-subtitle', {
        duration: 1,
        y: 50,
        opacity: 0,
        ease: "power2.out"
      }, "-=1")
      .from('.hero-description', {
        duration: 1,
        y: 30,
        opacity: 0,
        ease: "power2.out"
      }, "-=0.8")
      .from('.cta-button', {
        duration: 0.8,
        y: 20,
        opacity: 0,
        ease: "back.out(1.7)"
      }, "-=0.6");

    // Section Titles Animation
    gsap.utils.toArray('.section-title').forEach(title => {
      gsap.from(title, {
        scrollTrigger: {
          trigger: title,
          start: "top 80%",
          toggleActions: "play none none reverse"
        },
        duration: 1,
        y: 50,
        opacity: 0,
        ease: "power2.out"
      });
    });

    // Game Cards Animation
    gsap.utils.toArray('.game-card').forEach((card, index) => {
      gsap.from(card, {
        scrollTrigger: {
          trigger: card,
          start: "top 85%",
          toggleActions: "play none none reverse"
        },
        duration: 1,
        y: 100,
        rotationX: 45,
        opacity: 0,
        delay: index * 0.2,
        ease: "power2.out"
      });
    });

    // Features Animation
    gsap.utils.toArray('.feature-item').forEach((item, index) => {
      gsap.from(item, {
        scrollTrigger: {
          trigger: item,
          start: "top 80%",
          toggleActions: "play none none reverse"
        },
        duration: 1,
        x: -100,
        opacity: 0,
        delay: index * 0.3,
        ease: "power2.out"
      });
    });

    // Rules Animation
    gsap.utils.toArray('.rule-item').forEach((rule, index) => {
      gsap.from(rule, {
        scrollTrigger: {
          trigger: rule,
          start: "top 80%",
          toggleActions: "play none none reverse"
        },
        duration: 1,
        x: 100,
        opacity: 0,
        delay: index * 0.2,
        ease: "power2.out"
      });
    });

    // Card Hover Effects
    document.querySelectorAll('.game-card').forEach(card => {
      card.addEventListener('mouseenter', () => {
        gsap.to(card, {
          duration: 0.3,
          y: -10,
          rotationX: 0,
          ease: "power2.out"
        });
      });

      card.addEventListener('mouseleave', () => {
        gsap.to(card, {
          duration: 0.3,
          y: 0,
          ease: "power2.out"
        });
      });
    });

    // Scroll to cards function

    // Initialize particles
    createParticles();
  </script>
  <script>
    const keyboard = document.getElementById('keyboard');
    const status = document.getElementById('status');

    // Define key layout
    const keyLayout = [
      ["â†‘"],                  // first row (Arrow Up)
      ["â†", "â†“", "â†’"]        // second row (Arrow Left, Down, Right)
    ];

    function createKeys() {
      keyboard.innerHTML = "";
      keyLayout.forEach(rowKeys => {
        const row = document.createElement('div');
        row.classList.add('row');

        rowKeys.forEach(key => {
          const keyElement = document.createElement('div');
          keyElement.classList.add('key');
          keyElement.textContent = key.toUpperCase();
          // Determine if this is an arrow display key or WASD
          const arrowDisplayToCode = { 'â†‘': 'ArrowUp', 'â†': 'ArrowLeft', 'â†“': 'ArrowDown', 'â†’': 'ArrowRight' };
          const isArrow = Object.prototype.hasOwnProperty.call(arrowDisplayToCode, key);
          const value = isArrow ? arrowDisplayToCode[key] : key;
          keyElement.addEventListener('click', (e) => simulateKeyPress(value, e.currentTarget));
          row.appendChild(keyElement);
        });

        keyboard.appendChild(row);
      });
    }

    function simulateKeyPress(key, keyElement) {
      // Create and dispatch a real keyboard event
      const isArrow = key.startsWith('Arrow');
      const codeMap = { ArrowUp: 38, ArrowLeft: 37, ArrowDown: 40, ArrowRight: 39 };
      const keydownEvent = new KeyboardEvent('keydown', {
        key: key,
        code: key,
        keyCode: codeMap[key],
        which: codeMap[key],
        bubbles: true,
        cancelable: true
      });

      const keyupEvent = new KeyboardEvent('keyup', {
        key: key,
        code: key,
        keyCode: codeMap[key],
        which: codeMap[key],
        bubbles: true,
        cancelable: true
      });

      // Dispatch the events to simulate actual key press
      document.dispatchEvent(keydownEvent);

      // Visual feedback
      const dirMap = { arrowup: 'up', arrowleft: 'left', arrowdown: 'down', arrowright: 'right' };
      const arrowMap = { up: 'ðŸ¡¡', left: 'ðŸ¡ ', down: 'ðŸ¡£', right: 'ðŸ¡¢' };
      const direction = dirMap[key.toLowerCase()];
      const arrow = direction ? arrowMap[direction] : '';
      status.textContent = `${arrow} pressed!`;
      if (keyElement) {
        keyElement.style.backgroundColor = '#4CAF50';
      }

      setTimeout(() => {
        if (keyElement) {
          keyElement.style.backgroundColor = '#e0e0e0';
        }
        document.dispatchEvent(keyupEvent);
        status.textContent = 'Click keys to move Pacman!';
      }, 150);
    }

    // Handle physical keyboard input (show visual feedback)
    document.addEventListener('keydown', (event) => {
      const key = event.key.toLowerCase();
      const keyToDir = { arrowup: 'up', arrowleft: 'left', arrowdown: 'down', arrowright: 'right' };
      const dirToArrow = { up: 'ðŸ¡¡', left: 'ðŸ¡ ', down: 'ðŸ¡£', right: 'ðŸ¡¢' };
      const dir = keyToDir[key];
      if (dir) {
        status.textContent = `${dirToArrow[dir]} pressed (keyboard)!`;

        // Highlight the corresponding virtual Arrow key
        const dirToGlyph = { up: 'â†‘', left: 'â†', down: 'â†“', right: 'â†’' };
        const targetGlyph = dirToGlyph[dir];
        const keys = document.querySelectorAll('.key');
        keys.forEach(keyEl => {
          if (keyEl.textContent === targetGlyph) {
            keyEl.style.backgroundColor = '#4CAF50';
            setTimeout(() => {
              keyEl.style.backgroundColor = '#e0e0e0';
              status.textContent = 'Click keys to move Pacman!';
            }, 150);
          }
        });
      }
    });

    // Toggle keyboard visibility (for mobile)
    function toggleKeyboard() {
      const container = document.getElementById('keyboard-container');
      const toggle = document.getElementById('keyboard-toggle');

      container.style.display = 'block';  // always visible
      // or just remove toggle completely
    }
    function startGameUI() {
      document.body.classList.add('game-started');
      toggleKeyboard();
    }
    // Initialize keyboard
    createKeys();

    // Combined window.onload handler
    window.onload = () => {
      console.log('Page loaded - Initializing...');

      // Try to initialize the game
      if (typeof GameCoordinator === 'function') {
        let gameCoordinator = new GameCoordinator();
        console.log('GameCoordinator initialized');
      } else {
        console.error('GameCoordinator not found. Ensure build/app.js is loaded before calling new GameCoordinator().');
      }
    }
  </script>


</body>

</html>